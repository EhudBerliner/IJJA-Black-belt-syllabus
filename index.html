<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>סילבוס שחורה - IJJA</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2d3436;
            --secondary: #6c5ce7;
            --accent: #a29bfe;
            --bg: #f0f2f5;
            --text: #2d3436;
            --white: #ffffff;
            --header-h: 80px;
            --danger: #ff7675;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Heebo', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding-top: calc(var(--header-h) + 20px);
        }

        /* --- Header & Layout --- */
        header {
            background: var(--white);
            height: var(--header-h);
            position: fixed;
            top: 0; width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .header-right { display: flex; align-items: center; gap: 15px; }
        .logo-img { height: 50px; width: auto; }
        header h1 { font-size: 1.4rem; color: var(--primary); font-weight: 900; line-height: 1; }

        .action-bar { display: flex; gap: 8px; align-items: center; }

        /* --- Buttons Style --- */
        .btn {
            background: #eee; border: none;
            width: 40px; height: 40px;
            border-radius: 10px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1em; transition: all 0.2s; color: var(--primary);
        }
        .btn:active { transform: scale(0.9); }
        .btn.active { background: var(--secondary); color: white; }
        .btn-danger { color: var(--danger); }

        /* --- Dropdown Menu (The Solution) --- */
        .extra-menu {
            display: none;
            position: absolute;
            top: 70px; left: 15px;
            background: var(--white);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border-radius: 12px;
            flex-direction: column;
            z-index: 1100;
            overflow: hidden;
            border: 1px solid #eee;
        }
        .extra-menu.show { display: flex; }
        .menu-item {
            padding: 12px 20px;
            border: none; background: none;
            text-align: right; font-family: 'Heebo';
            cursor: pointer; border-bottom: 1px solid #f5f5f5;
            display: flex; align-items: center; gap: 10px;
            font-size: 0.95rem; width: 180px;
        }
        .menu-item:last-child { border-bottom: none; }
        .menu-item:hover { background: #f9f9f9; }

        /* --- Syllabus Content --- */
        .container { max-width: 800px; margin: 0 auto; padding: 0 15px 50px; }
        .category { background: var(--white); border-radius: 15px; margin-bottom: 15px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .category-header { background: var(--primary); color: white; padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .category-header h2 { font-size: 1.1rem; }
        .category-content { display: none; padding: 5px 0; }
        .category.open .category-content { display: block; }

        .technique-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 20px; border-bottom: 1px solid #eee;
        }
        .tech-info { flex-grow: 1; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .tech-actions { display: flex; gap: 15px; }
        .fav-btn { color: #ccc; cursor: pointer; font-size: 1.2rem; }
        .fav-btn.active { color: #f1c40f; }
        
        /* Watchdog indicator */
        .tech-info.watched { border-right: 4px solid var(--secondary); padding-right: 8px; }

        /* --- Video Modal --- */
        #videoModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center;
        }
        .modal-content { width: 95%; max-width: 700px; position: relative; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 10px; }
        .close-modal { position: absolute; top: -40px; left: 0; color: white; font-size: 2rem; cursor: pointer; }

        /* --- Mobile Adjustments --- */
        @media (max-width: 600px) {
            :root { --header-h: 70px; }
            header { padding: 0 10px; }
            .logo-img { height: 38px; }
            header h1 { font-size: 1.1rem; max-width: 100px; }
            .action-bar { gap: 5px; }
            .btn { width: 36px; height: 36px; font-size: 1rem; }
        }
    </style>
</head>
<body>

<header>
    <div class="header-right">
        <img src="Logo.png" alt="IJJA" class="logo-img">
        <div>
            <h1>סילבוס שחורה</h1>
            <small id="appVersion" style="color:#888; font-size: 0.7em;">v12.0.3</small>
        </div>
    </div>
    
    <div class="action-bar">
        <button id="ytModeToggle" title="מצב Youtube" class="btn" onclick="toggleYtMode()"><i class="fab fa-youtube"></i></button>
        <button id="watchdogToggle" title="Watchdog" class="btn active" onclick="toggleWatchdog()"><i class="fas fa-history"></i></button>
        <button title="אקראי" class="btn" onclick="playRandom()"><i class="fas fa-random"></i></button>
        <button id="favFilterBtn" title="מועדפים" class="btn" onclick="toggleFavFilter()"><i class="fas fa-star"></i></button>
        
        <button id="moreBtn" title="עוד" class="btn" onclick="toggleExtraMenu(event)"><i class="fas fa-ellipsis-v"></i></button>
    </div>

    <div id="extraMenu" class="extra-menu">
        <button class="menu-item" onclick="toggleAll()">
            <i class="fas fa-arrows-alt-v"></i> פתח/סגור הכל
        </button>
        <button class="menu-item btn-danger" onclick="clearFavs()">
            <i class="fas fa-trash-alt"></i> ניקוי מועדפים
        </button>
    </div>
</header>

<div class="container" id="syllabusContent">
    </div>

<div id="videoModal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div class="video-container" id="videoWrapper">
            </div>
    </div>
</div>

<script>
    // --- Data Configuration ---
    const categories = [
        {
            title: "עמידה וטייקדאונס",
            techniques: [
                { name: "Single Leg", id: "sl1", url: "https://www.youtube.com/embed/dQw4w9WgXcQ" },
                { name: "Double Leg", id: "dl1", url: "https://www.youtube.com/embed/dQw4w9WgXcQ" }
            ]
        },
        {
            title: "גארד פתוח",
            techniques: [
                { name: "De La Riva Sweep", id: "dlr1", url: "https://www.youtube.com/embed/dQw4w9WgXcQ" },
                { name: "Spider Guard Triangle", id: "sg1", url: "https://www.youtube.com/embed/dQw4w9WgXcQ" }
            ]
        }
    ];

    let favorites = JSON.parse(localStorage.getItem('bjj_favs')) || [];
    let watched = JSON.parse(localStorage.getItem('bjj_watched')) || [];
    let isWatchdogActive = true;
    let isFavFilterActive = false;
    let ytMode = false;

    // --- Core Functions ---

    function renderSyllabus() {
        const container = document.getElementById('syllabusContent');
        container.innerHTML = '';

        categories.forEach((cat, catIdx) => {
            let filteredTechs = cat.techniques;
            if (isFavFilterActive) {
                filteredTechs = cat.techniques.filter(t => favorites.includes(t.id));
            }

            if (filteredTechs.length === 0 && isFavFilterActive) return;

            const catDiv = document.createElement('div');
            catDiv.className = 'category';
            catDiv.innerHTML = `
                <div class="category-header" onclick="this.parentElement.classList.toggle('open')">
                    <h2>${cat.title}</h2>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="category-content">
                    ${filteredTechs.map(tech => `
                        <div class="technique-item">
                            <div class="tech-info ${watched.includes(tech.id) ? 'watched' : ''}" onclick="playVideo('${tech.url}', '${tech.id}')">
                                <i class="fas fa-play-circle" style="color: var(--secondary)"></i>
                                <span>${tech.name}</span>
                            </div>
                            <div class="tech-actions">
                                <i class="${favorites.includes(tech.id) ? 'fas' : 'far'} fa-star fav-btn ${favorites.includes(tech.id) ? 'active' : ''}" 
                                   onclick="toggleFavorite('${tech.id}')"></i>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(catDiv);
        });
    }

    function playVideo(url, id) {
        if (isWatchdogActive && !watched.includes(id)) {
            watched.push(id);
            localStorage.setItem('bjj_watched', JSON.stringify(watched));
            renderSyllabus();
        }

        if (ytMode) {
            window.open(url.replace('embed/', 'watch?v='), '_blank');
        } else {
            document.getElementById('videoWrapper').innerHTML = `<iframe src="${url}?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
            document.getElementById('videoModal').style.display = 'flex';
        }
    }

    function closeModal() {
        document.getElementById('videoModal').style.display = 'none';
        document.getElementById('videoWrapper').innerHTML = '';
    }

    function toggleFavorite(id) {
        if (favorites.includes(id)) {
            favorites = favorites.filter(fid => fid !== id);
        } else {
            favorites.push(id);
        }
        localStorage.setItem('bjj_favs', JSON.stringify(favorites));
        renderSyllabus();
    }

    function toggleFavFilter() {
        isFavFilterActive = !isFavFilterActive;
        document.getElementById('favFilterBtn').classList.toggle('active');
        renderSyllabus();
    }

    function toggleWatchdog() {
        isWatchdogActive = !isWatchdogActive;
        document.getElementById('watchdogToggle').classList.toggle('active');
    }

    function toggleYtMode() {
        ytMode = !ytMode;
        document.getElementById('ytModeToggle').classList.toggle('active');
    }

    function playRandom() {
        const allTechs = categories.flatMap(c => c.techniques);
        const rand = allTechs[Math.floor(Math.random() * allTechs.length)];
        playVideo(rand.url, rand.id);
    }

    function toggleAll() {
        const cats = document.querySelectorAll('.category');
        const anyOpen = Array.from(cats).some(c => c.classList.contains('open'));
        cats.forEach(c => c.classList.toggle('open', !anyOpen));
        closeExtraMenu();
    }

    function clearFavs() {
        if (confirm('למחוק את כל המועדפים?')) {
            favorites = [];
            localStorage.setItem('bjj_favs', JSON.stringify(favorites));
            renderSyllabus();
        }
        closeExtraMenu();
    }

    // --- UI Helpers ---

    function toggleExtraMenu(e) {
        e.stopPropagation();
        document.getElementById('extraMenu').classList.toggle('show');
    }

    function closeExtraMenu() {
        document.getElementById('extraMenu').classList.remove('show');
    }

    // סגירת תפריט בלחיצה מחוץ לו
    window.onclick = function(event) {
        if (!event.target.closest('.action-bar') && !event.target.closest('#extraMenu')) {
            closeExtraMenu();
        }
    }

    // Initial Load
    renderSyllabus();
</script>

</body>
</html>
